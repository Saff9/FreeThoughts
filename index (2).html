<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="GenZ Smart Blog by Owais ‚Äî ideas, tech, and life from Kashmir." />
<meta name="theme-color" content="#6A5ACD" />
<title>GenZ Smart Blog</title>

<style>
/* ============ Base / Reset ============ */
*{box-sizing:border-box}html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block}
button{cursor:pointer;border:none;outline:none}
.hidden{display:none}

/* ============ Colors ============ */
:root{
  --brand:#6A5ACD;         /* slate purple */
  --brand-2:#00D4FF;       /* aqua accent */
  --bg:#f6f8fb;
  --surface:#ffffff;
  --text:#1a1a1a;
  --muted:#6b7280;
  --border:#e5e7eb;
  --good:#22c55e;
  --bad:#ef4444;
}
body.dark{
  --bg:#0e0f13;
  --surface:#151821;
  --text:#e5e7eb;
  --muted:#9aa4b2;
  --border:#242834;
}

/* ============ Layout ============ */
body{background:var(--bg);color:var(--text);transition:background .25s,color .25s}
.container{max-width:1200px;margin:0 auto;padding:16px}

/* ============ Header ============ */
header{position:sticky;top:0;z-index:50;background:var(--surface);
  border-bottom:1px solid var(--border);box-shadow:0 4px 18px rgba(0,0,0,.06)}
.head-wrap{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
.brand{
  font-weight:800;letter-spacing:.4px;
  background:linear-gradient(90deg,var(--brand),var(--brand-2));
  -webkit-background-clip:text;background-clip:text;color:transparent;
  font-size:20px
}
.menu-btn{font-size:28px;line-height:0;background:transparent;color:var(--text)}

/* ============ Drawer Menu ============ */
.drawer{position:fixed;inset:0;pointer-events:none}
.drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.35);opacity:0;transition:.25s}
.drawer.open .backdrop{opacity:1;pointer-events:auto}
.panel{
  position:absolute;top:0;left:0;height:100%;width:310px;background:var(--surface);
  border-right:1px solid var(--border);transform:translateX(-105%);transition:.25s;
  display:flex;flex-direction:column;gap:10px;padding:18px
}
.drawer.open .panel{transform:translateX(0);pointer-events:auto}
.nav-title{font-weight:700;margin-bottom:6px}
.nav a{display:flex;align-items:center;gap:10px;padding:12px;border-radius:10px;color:var(--text)}
.nav a:hover{background:rgba(0,0,0,.06)}
body.dark .nav a:hover{background:#1f2330}
.divider{height:1px;background:var(--border);margin:8px 0}
.dark-toggle{margin-top:auto;padding:10px 12px;border:1px solid var(--border);border-radius:10px;text-align:center}

/* ============ Loader & Toast ============ */
#loader{position:fixed;inset:0;background:var(--surface);display:flex;align-items:center;justify-content:center;z-index:60}
.spinner{width:44px;height:44px;border:4px solid var(--border);border-top-color:var(--brand);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:18px;right:18px;background:var(--text);color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(8px);transition:.25s;z-index:70}
.toast.show{opacity:1;transform:none}

/* ============ Hero ============ */
.hero{position:relative;height:320px;border-radius:16px;overflow:hidden;margin:18px 0}
.hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity 1s}
.hero img.active{opacity:1}
.hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.0),rgba(0,0,0,.45))}
.hero-title{position:absolute;left:18px;bottom:14px;color:#fff;font-weight:700;font-size:20px}

/* ============ Sections ============ */
section{margin:26px 0}
h2{font-size:22px;margin:8px 4px 14px}

/* ============ Cards / Posts ============ */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 4px 16px rgba(0,0,0,.05);transition:transform .2s}
.card:hover{transform:translateY(-4px)}
.card-img{height:180px;background:#111;object-fit:cover}
.card-body{padding:14px}
.card-title{font-weight:700;margin-bottom:6px;font-size:18px}
.card-meta{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:12px;margin-bottom:8px}
.avatar{width:26px;height:26px;border-radius:50%;flex:0 0 26px;background:#e5e7eb;overflow:hidden;border:1px solid var(--border)}
.avatar img{width:100%;height:100%;object-fit:cover}
.card-content{color:var(--text);font-size:14px;line-height:1.55;word-break:break-word}
.card-actions{display:flex;gap:8px;margin-top:10px}
.btn{padding:8px 10px;border-radius:10px;font-weight:600}
.btn-edit{background:var(--good);color:#fff}
.btn-del{background:var(--bad);color:#fff}

/* ============ Skeletons ============ */
.skel{height:230px;border-radius:16px;background:linear-gradient(90deg,#e5e7eb,#f3f4f6,#e5e7eb);background-size:200% 100%;animation:shimmer 1.1s infinite}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
body.dark .skel{background:linear-gradient(90deg,#1f2330,#242a3a,#1f2330)}

/* ============ About Me snippet ============ */
.about-snippet{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px;display:grid;grid-template-columns:78px 1fr;gap:12px;align-items:center}
.about-avatar{width:78px;height:78px;border-radius:50%;overflow:hidden;border:1px solid var(--border)}
.about-snippet p{margin:0;color:var(--muted)}
.about-actions{display:flex;gap:10px;margin-top:10px}
.link-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid var(--border);border-radius:10px}
.link-btn:hover{border-color:var(--brand)}

/* ============ Footer ============ */
footer{margin:30px 0 20px;text-align:center;color:var(--muted)}
.legal{font-size:13px}
.legal strong{color:var(--text)}

/* ============ Modals ============ */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:80}
.modal.show{display:flex}
.modal .mask{position:absolute;inset:0;background:rgba(0,0,0,.5)}
.modal-card{position:relative;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px;max-width:520px;width:92%}
.modal-card h3{margin:6px 0 12px}
.modal-card input,.modal-card textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text);margin:6px 0}
.modal-actions{display:flex;gap:10px;margin-top:10px;justify-content:flex-end}
.btn-plain{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--text)}
.btn-primary{padding:8px 12px;border-radius:10px;background:var(--brand);color:#fff}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader"><div class="spinner" aria-label="Loading"></div></div>

<!-- Header -->
<header>
  <div class="head-wrap container">
    <div class="brand">GenZ Smart Blog</div>
    <button class="menu-btn" aria-label="Open menu">&#9776;</button>
  </div>
</header>

<!-- Drawer Menu -->
<div class="drawer" id="drawer">
  <div class="backdrop" id="backdrop"></div>
  <aside class="panel">
    <div class="nav-title">Menu</div>
    <nav class="nav">
      <a href="#home" class="nav-link">üè† Home</a>
      <a href="#blog" class="nav-link">üì∞ Blog</a>
      <a href="#about" class="nav-link">üë§ About Me</a>
      <div class="divider"></div>
      <a href="https://youtube.com/@calizenowais?si=y5c2lp6JfCjSiJXB" class="nav-link" target="_blank" rel="noopener">üì∫ YouTube</a>
      <a href="https://www.instagram.com/owaisdar_511?igsh=MWV6d21lbjVpNXh6Yg==" class="nav-link" target="_blank" rel="noopener">üì∏ Instagram</a>
      <div class="divider"></div>

      <!-- Admin Area inside drawer -->
      <div id="admin-area">
        <div class="nav-title">Admin</div>
        <div id="login-box">
          <input type="email" id="admin-email" placeholder="Email" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text)">
          <input type="password" id="admin-pass" placeholder="Password" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text);margin-top:8px">
          <button id="login-btn" class="btn-primary" style="width:100%;margin-top:10px">Login</button>
        </div>

        <div id="admin-panel" class="hidden">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <strong>Welcome, Owais</strong>
            <button id="logout-btn" class="btn-plain">Logout</button>
          </div>
          <input id="new-title" type="text" placeholder="Post title">
          <textarea id="new-content" rows="4" placeholder="Write your post (links auto-clickable)"></textarea>
          <input id="new-image" type="file" accept="image/*">
          <button id="publish-btn" class="btn-primary" style="width:100%;margin-top:6px">Publish</button>
          <small style="color:var(--muted)">Author: <strong>By GenZ Owais</strong></small>
        </div>
      </div>
    </nav>
    <div class="divider"></div>
    <button id="dark-toggle" class="dark-toggle">üåô Toggle Dark Mode</button>
  </aside>
</div>

<!-- Main -->
<main class="container">

  <!-- Hero -->
  <div id="home"></div>
  <section class="hero" aria-label="Featured">
    <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1600&auto=format&fit=crop" class="active" alt="Coding" />
    <img src="https://images.unsplash.com/photo-1526378722484-bd91ca387e72?q=80&w=1600&auto=format&fit=crop" alt="AI" />
    <img src="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1600&auto=format&fit=crop" alt="Inspiration" />
    <div class="hero-overlay"></div>
    <div class="hero-title">Fresh ideas. Clean code. GenZ Smart.</div>
  </section>

  <!-- About snippet on Home -->
  <section>
    <div class="about-snippet">
      <div class="about-avatar">
        <!-- default avatar (WhatsApp-like) -->
        <img alt="avatar" src="data:image/svg+xml;utf8,
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'>
          <rect width='128' height='128' rx='64' fill='%23e5e7eb'/>
          <circle cx='64' cy='50' r='26' fill='%23c7ccd4'/>
          <rect x='22' y='84' width='84' height='34' rx='17' fill='%23c7ccd4'/>
        </svg>" />
      </div>
      <div>
        <h3 style="margin:0 0 4px">About Owais</h3>
        <p>High schooler from Kashmir, India ‚Äî curious mind, positive vibes, and big dreams. Always learning, building, and creating. üöÄ</p>
        <div class="about-actions">
          <a class="link-btn" href="#about">Read More</a>
          <a class="link-btn" href="https://youtube.com/@calizenowais?si=y5c2lp6JfCjSiJXB" target="_blank" rel="noopener">üì∫ YouTube</a>
          <a class="link-btn" href="https://www.instagram.com/owaisdar_511?igsh=MWV6d21lbjVpNXh6Yg==" target="_blank" rel="noopener">üì∏ Instagram</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Posts (7 days) -->
  <section>
    <h2>Latest posts (last 7 days)</h2>
    <div id="latest-grid" class="grid">
      <div class="skel"></div><div class="skel"></div><div class="skel"></div>
    </div>
  </section>

  <!-- Blog -->
  <section id="blog">
    <h2>All Blog Posts</h2>
    <div id="all-grid" class="grid">
      <div class="skel"></div><div class="skel"></div><div class="skel"></div>
    </div>
  </section>

  <!-- About Me (full) -->
  <section id="about">
    <h2>About Me</h2>
    <div class="card" style="padding:16px">
      <p>Hey there! I‚Äôm Owais Ahmad, a high school student born and raised in the breathtaking valleys of Kashmir, India. I‚Äôm passionate about learning new things, exploring creative ideas, and making each day count.</p>
      <p>I‚Äôve got a curious mind, a drive to grow, and a dream to create something meaningful in this world. Whether it‚Äôs diving into books, exploring tech, or just enjoying the peace of the mountains‚ÄîI'm always looking for inspiration.</p>
      <p>I believe in staying positive, working hard, and never stopping the hustle. Still young, but dreaming big ‚Äî and I‚Äôm just getting started. üöÄ</p>
      <p>Let‚Äôs make it happen!</p>
      <div class="about-actions">
        <a class="link-btn" href="https://youtube.com/@calizenowais?si=y5c2lp6JfCjSiJXB" target="_blank" rel="noopener">üì∫ YouTube</a>
        <a class="link-btn" href="https://www.instagram.com/owaisdar_511?igsh=MWV6d21lbjVpNXh6Yg==" target="_blank" rel="noopener">üì∏ Instagram</a>
      </div>
    </div>
  </section>

</main>

<!-- Footer -->
<footer>
  <div class="legal"><strong>GenZ Smart Blog</strong> ‚Äî ¬© <span id="yr"></span>. All rights reserved.</div>
</footer>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Modals -->
<div id="editModal" class="modal" aria-hidden="true">
  <div class="mask"></div>
  <div class="modal-card">
    <h3>Edit Post</h3>
    <input id="edit-title" type="text" placeholder="Title" />
    <textarea id="edit-content" rows="5" placeholder="Content..."></textarea>
    <input id="edit-image" type="file" accept="image/*" />
    <div class="modal-actions">
      <button class="btn-plain" id="cancelEdit">Cancel</button>
      <button class="btn-primary" id="saveEdit">Save</button>
    </div>
  </div>
</div>

<div id="confirmModal" class="modal" aria-hidden="true">
  <div class="mask"></div>
  <div class="modal-card">
    <h3>Delete this post?</h3>
    <p>This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn-plain" id="cancelDel">Cancel</button>
      <button class="btn-primary" id="confirmDel">Delete</button>
    </div>
  </div>
</div>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
/* ---------------- Firebase ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDWkhmOClcLO3Ln7Za6zwt6d2nrO24spq4",
  authDomain: "myblog-61329.firebaseapp.com",
  projectId: "myblog-61329",
  storageBucket: "myblog-61329.appspot.com",
  messagingSenderId: "59428518621",
  appId: "1:59428518621:web:7b11c58a518233b248b934",
  measurementId: "G-EVV8SE32BQ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
const postsRef = db.collection('posts');

/* ---------------- State ---------------- */
let isAdmin = sessionStorage.getItem('isAdmin') === 'true';
let cache = new Map();      // id -> post
let editId = null;          // current editing doc id
let delId = null;           // current deleting doc id

/* ---------------- UI Elements ---------------- */
const drawer = document.getElementById('drawer');
const backdrop = document.getElementById('backdrop');
const menuBtn = document.querySelector('.menu-btn');
const navLinks = document.querySelectorAll('.nav-link');
const darkToggle = document.getElementById('dark-toggle');
const toast = document.getElementById('toast');
const loader = document.getElementById('loader');

const loginBox = document.getElementById('login-box');
const adminPanel = document.getElementById('admin-panel');
const loginBtn = document.getElementById('login-btn');
const logoutBtn = document.getElementById('logout-btn');

const latestGrid = document.getElementById('latest-grid');
const allGrid = document.getElementById('all-grid');

const publishBtn = document.getElementById('publish-btn');
const newTitle = document.getElementById('new-title');
const newContent = document.getElementById('new-content');
const newImage = document.getElementById('new-image');

const editModal = document.getElementById('editModal');
const editTitle = document.getElementById('edit-title');
const editContent = document.getElementById('edit-content');
const editImage = document.getElementById('edit-image');
const saveEdit = document.getElementById('saveEdit');
const cancelEdit = document.getElementById('cancelEdit');

const confirmModal = document.getElementById('confirmModal');
const confirmDel = document.getElementById('confirmDel');
const cancelDel = document.getElementById('cancelDel');

/* ---------------- Helpers ---------------- */
function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2600); }
function openDrawer(){ drawer.classList.add('open'); }
function closeDrawer(){ drawer.classList.remove('open'); }
function setDark(on){ document.body.classList.toggle('dark', on); localStorage.setItem('dark', on); }
function makeLinks(text){
  if(!text) return '';
  const escaped = text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
  const withLinks = escaped.replace(/((https?:\/\/|www\.)[^\s]+)/gi, (m)=>{
    const url = m.startsWith('http') ? m : 'http://' + m;
    return `<a href="${url}" target="_blank" rel="noopener">${m}</a>`;
  });
  return withLinks.replace(/\n/g,'<br>');
}
function daysBetween(a,b){ return (a - b)/(1000*60*60*24); }
function now(){ return new Date(); }
function defaultPostImage(){
  return 'https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1200&auto=format&fit=crop';
}
function avatarSVG(){
  return "data:image/svg+xml;utf8,"+
  "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'>"+
  "<rect width='128' height='128' rx='64' fill='%23e5e7eb'/>"+
  "<circle cx='64' cy='50' r='26' fill='%23c7ccd4'/>"+
  "<rect x='22' y='84' width='84' height='34' rx='17' fill='%23c7ccd4'/>"+
  "</svg>";
}

/* ---------------- Header / Drawer / Dark Mode ---------------- */
menuBtn.addEventListener('click', openDrawer);
backdrop.addEventListener('click', closeDrawer);
navLinks.forEach(l => l.addEventListener('click', closeDrawer));
darkToggle.addEventListener('click', ()=>{
  setDark(!document.body.classList.contains('dark'));
});
if(localStorage.getItem('dark') === 'true'){ setDark(true); }

/* ---------------- Hero Slider ---------------- */
(function hero(){
  const imgs = document.querySelectorAll('.hero img');
  let i = 0;
  setInterval(()=>{
    imgs[i].classList.remove('active');
    i = (i+1) % imgs.length;
    imgs[i].classList.add('active');
  }, 4000);
})();

/* ---------------- Footer year ---------------- */
document.getElementById('yr').textContent = new Date().getFullYear();

/* ---------------- Admin Login (HTML only) ---------------- */
function syncAdminUI(){
  if(isAdmin){ loginBox.classList.add('hidden'); adminPanel.classList.remove('hidden'); }
  else{ adminPanel.classList.add('hidden'); loginBox.classList.remove('hidden'); }
}
loginBtn.addEventListener('click', ()=>{
  const email = document.getElementById('admin-email').value.trim();
  const pass = document.getElementById('admin-pass').value.trim();
  if(email === "saffanakbar942@gmail.com" && pass === "saffan942"){
    isAdmin = true; sessionStorage.setItem('isAdmin','true'); syncAdminUI(); showToast('Logged in as Admin'); 
  }else{
    showToast('Invalid credentials');
  }
});
logoutBtn.addEventListener('click', ()=>{
  isAdmin = false; sessionStorage.removeItem('isAdmin'); syncAdminUI(); showToast('Logged out');
});
syncAdminUI();

/* ---------------- Create Post ---------------- */
publishBtn.addEventListener('click', async ()=>{
  if(!isAdmin){ showToast('Admin only'); return; }
  const title = newTitle.value.trim();
  const content = newContent.value.trim();
  const file = newImage.files[0];
  if(!title || !content){ showToast('Title & content required'); return; }

  let imageURL = "";
  try{
    if(file){
      const storageRef = storage.ref('posts/'+ Date.now() + '_' + file.name);
      await storageRef.put(file);
      imageURL = await storageRef.getDownloadURL();
    }
  }catch(e){
    console.error(e); showToast('Image upload failed, posting without image');
  }

  try{
    await postsRef.add({
      title, content, image: imageURL, author: "By GenZ Owais",
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    newTitle.value = ''; newContent.value=''; newImage.value='';
    showToast('Post published');
  }catch(e){
    console.error(e); showToast('Failed to publish (check Firestore rules)');
  }
});

/* ---------------- Live Posts (Realtime) ---------------- */
function renderPosts(docs){
  cache.clear();
  latestGrid.innerHTML = ''; allGrid.innerHTML = '';

  if(docs.length === 0){
    latestGrid.innerHTML = '<div class="card" style="padding:16px">No posts yet.</div>';
    allGrid.innerHTML = '<div class="card" style="padding:16px">No posts yet.</div>';
    return;
  }

  const seven = 7;
  const cur = now();

  docs.forEach(d=>{
    const id = d.id;
    const p = d.data();
    cache.set(id, p);
    const ts = p.timestamp ? p.timestamp.toDate() : new Date();
    const postEl = cardEl(id, p.title, p.content, p.image || '', p.author || 'By GenZ Owais', ts);
    allGrid.appendChild(postEl);
    if(daysBetween(cur, ts) <= seven){
      latestGrid.appendChild(postEl.cloneNode(true));
    }
  });

  // Hook actions (delegated)
  allGrid.addEventListener('click', handleActions);
  latestGrid.addEventListener('click', handleActions);
}

function cardEl(id, title, content, image, author, dateObj){
  const card = document.createElement('div');
  card.className = 'card';
  const safeTitle = title || '(no title)';
  const safeImage = image || defaultPostImage();

  card.innerHTML = `
    <img class="card-img" src="${safeImage}" alt="">
    <div class="card-body">
      <div class="card-title">${safeTitle}</div>
      <div class="card-meta">
        <span class="avatar"><img alt="dp" src="${avatarSVG()}"></span>
        <span>${author}</span> ¬∑ <span>${dateObj.toDateString()}</span>
      </div>
      <div class="card-content">${makeLinks(content)}</div>
      ${isAdmin ? `
        <div class="card-actions">
          <button class="btn btn-edit" data-action="edit" data-id="${id}">Edit</button>
          <button class="btn btn-del" data-action="delete" data-id="${id}">Delete</button>
        </div>` : ``}
    </div>
  `;
  return card;
}

function handleActions(e){
  const btn = e.target.closest('button[data-action]');
  if(!btn) return;
  const id = btn.getAttribute('data-id');
  const action = btn.getAttribute('data-action');
  if(action === 'edit'){ openEdit(id); }
  if(action === 'delete'){ openDelete(id); }
}

/* ---------------- Edit / Delete ---------------- */
function openEdit(id){
  if(!isAdmin){ showToast('Admin only'); return; }
  const p = cache.get(id); if(!p) return;
  editId = id;
  editTitle.value = p.title || '';
  editContent.value = p.content || '';
  editImage.value = '';
  editModal.classList.add('show');
}
cancelEdit.addEventListener('click', ()=> editModal.classList.remove('show'));
editModal.querySelector('.mask').addEventListener('click', ()=> editModal.classList.remove('show'));

saveEdit.addEventListener('click', async ()=>{
  if(!editId) return;
  const title = editTitle.value.trim();
  const content = editContent.value.trim();
  const file = editImage.files[0];
  let update = { title, content };

  try{
    if(file){
      const storageRef = storage.ref('posts/'+ Date.now() + '_' + file.name);
      await storageRef.put(file);
      update.image = await storageRef.getDownloadURL();
    }
    await postsRef.doc(editId).update(update);
    showToast('Post updated');
  }catch(e){
    console.error(e); showToast('Failed to update');
  }
  editModal.classList.remove('show');
});

function openDelete(id){
  if(!isAdmin){ showToast('Admin only'); return; }
  delId = id;
  confirmModal.classList.add('show');
}
cancelDel.addEventListener('click', ()=> confirmModal.classList.remove('show'));
confirmModal.querySelector('.mask').addEventListener('click', ()=> confirmModal.classList.remove('show'));
confirmDel.addEventListener('click', async ()=>{
  if(!delId) return;
  try{
    await postsRef.doc(delId).delete();
    showToast('Post deleted');
  }catch(e){
    console.error(e); showToast('Delete failed');
  }
  confirmModal.classList.remove('show');
});

/* ---------------- Snapshot + Loader ---------------- */
postsRef.orderBy('timestamp','desc').onSnapshot({
  next:(snap)=>{
    loader.style.display='none';
    renderPosts(snap.docs);
  },
  error:(err)=>{
    loader.style.display='none';
    console.error(err); showToast('Failed to load posts');
  }
});
</script>
</body>
</html>